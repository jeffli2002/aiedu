# Cloudflare R2 访问密钥获取 - 替代方案

如果 Cloudflare Dashboard 中没有 "Cloudflare R2" 选项，可以使用以下方法：

## 方法 1：使用 "Edit Cloudflare Workers" 模板（最简单）

1. 访问：https://dash.cloudflare.com/profile/api-tokens
2. 点击 **"Create Token"**
3. 在页面顶部，查找 **"Use template"** 或模板列表
4. 选择 **"Edit Cloudflare Workers"** 模板
5. 这个模板通常已经包含了 R2 的权限
6. 点击 **"Continue to summary"** > **"Create Token"**
7. 复制生成的 Token

## 方法 2：尝试 "Workers" 权限

如果模板不可用，尝试自定义权限：

1. 在 "Create Custom Token" 页面：
   - **第一个下拉菜单**：选择 **"Account"**
   - **第二个下拉菜单**：输入 **"Workers"** 并选择
   - **第三个下拉菜单**：选择 **"Edit"**
2. 点击 **"Continue to summary"** > **"Create Token"**
3. 复制生成的 Token

## 方法 3：使用 Global API Key（不推荐，但可用）

如果以上方法都不行，可以使用 Global API Key：

1. 访问：https://dash.cloudflare.com/profile/api-tokens
2. 在页面底部找到 **"API Keys"** 部分
3. 找到 **"Global API Key"**
4. 点击 **"View"** 并验证身份
5. 复制 Global API Key

⚠️ **注意**：Global API Key 权限过大，建议仅用于测试。

## 方法 4：直接使用 API（无需特殊权限）

如果您的账户有 R2 访问权限，可以直接使用 API 创建访问密钥，但需要：

1. **获取 Account ID**：`ccb5990ee93ad99d5ada77b738e942c6`
2. **使用任何有效的 API Token**（即使权限不完整，也可以尝试）

然后运行脚本：

```powershell
.\scripts\create-r2-token.ps1
```

## 推荐操作流程

1. **首先尝试方法 1**（使用模板）
2. **如果不行，尝试方法 2**（Workers 权限）
3. **如果还不行，尝试方法 4**（直接运行脚本，使用任何 API Token）

## 验证 API Token 是否有效

创建 API Token 后，可以测试是否有效：

```powershell
$accountId = "ccb5990ee93ad99d5ada77b738e942c6"
$apiToken = "your-api-token-here"

$headers = @{
    "Authorization" = "Bearer $apiToken"
    "Content-Type" = "application/json"
}

# 测试 API Token
try {
    $response = Invoke-RestMethod `
        -Uri "https://api.cloudflare.com/client/v4/accounts/$accountId/r2/buckets" `
        -Method Get `
        -Headers $headers
    
    Write-Host "✅ API Token 有效！" -ForegroundColor Green
} catch {
    Write-Host "❌ API Token 无效或权限不足: $($_.Exception.Message)" -ForegroundColor Red
}
```

## 如果所有方法都失败

如果以上方法都不行，可能需要：

1. **检查账户权限**：确保您的账户有 R2 访问权限
2. **联系 Cloudflare 支持**：可能需要启用 R2 服务
3. **使用 Wrangler CLI**：Cloudflare 的命令行工具，可以直接创建 R2 访问密钥

### 使用 Wrangler CLI（高级方法）

1. 安装 Wrangler：
   ```powershell
   npm install -g wrangler
   ```

2. 登录：
   ```powershell
   wrangler login
   ```

3. 创建 R2 访问密钥：
   ```powershell
   wrangler r2 bucket create aiedu
   wrangler r2 object list --bucket aiedu
   ```

Wrangler 会自动处理认证，无需手动创建 API Token。




